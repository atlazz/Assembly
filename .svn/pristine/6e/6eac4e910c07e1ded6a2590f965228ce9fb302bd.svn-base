{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\view/assets\\scripts\\view\\HomeView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\view","sourcesContent":["import Global from \"../Global\";\r\nimport * as Const from \"../Const\";\r\nimport GameView from \"./GameView\"\r\nimport LvlSelect from \"./LvlSelect\";\r\nimport Loading from '../component/Loading';\r\nimport AudioMgr from \"../component/AudioMgr\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class HomeView extends cc.Component {\r\n    @property(cc.Node)\r\n    btn_start: cc.Node = null;\r\n    @property(cc.Node)\r\n    GameView: cc.Node = null;\r\n    @property(cc.Node)\r\n    LvlSelectView: cc.Node = null;\r\n    @property(cc.Node)\r\n    label_version: cc.Node = null;\r\n\r\n    private gameScript: GameView;\r\n    private lvlSelectScript: LvlSelect;\r\n\r\n    private initCnt: number = 0;\r\n    private hasAddlistener: boolean = false;\r\n\r\n    private touchTarget;\r\n\r\n    constructor() {\r\n        super();\r\n        // clear old list\r\n        try {\r\n            CC_WECHATGAME && wxDownloader['cleanCache'](wxDownloader['getCacheName'](GameView.BaseUrl + 'solution/title.json'));\r\n        } catch (e) { \r\n            console.log(\"clear cache file err:\", e);\r\n        }\r\n    }\r\n\r\n    start() {\r\n        // login\r\n        if (CC_WECHATGAME) {\r\n            Loading.initWeixin(() => {\r\n                console.log('login succeed.');\r\n                this.initCnt++;\r\n                this.initCnt >= 2 && this.onInitComplete();\r\n            });\r\n        } else {\r\n            GameView.BaseUrl = 'https://coolant.oss-cn-shenzhen.aliyuncs.com/Assembly/textures/game/';\r\n            this.initCnt++;\r\n            this.initCnt >= 2 && this.onInitComplete();\r\n        }\r\n\r\n        // print version\r\n        this.label_version.getComponent(cc.Label).string = Const.VERSION;\r\n\r\n        // init LvlSelect\r\n        this.lvlSelectScript = this.LvlSelectView.getComponent(LvlSelect);\r\n\r\n        // load title json data\r\n        cc.loader.load(GameView.BaseUrl + 'solution/title.json', (error, jsonData) => {\r\n            if (error) { console.error('load title json error:', error) };\r\n            this.lvlSelectScript.titleJson = jsonData;\r\n            console.log('title json loaded.', this.lvlSelectScript.titleJson);\r\n            this.initCnt++;\r\n            this.initCnt >= 2 && this.onInitComplete();\r\n        });\r\n    }\r\n\r\n    private addBtnListener() {\r\n        // btn_start\r\n        this.btn_start.on(cc.Node.EventType.TOUCH_START, (e) => {\r\n            if (this.touchTarget && this.touchTarget != e.target) return;\r\n            this.touchTarget = e.target;\r\n            this.btn_start.color = new cc.Color(180, 180, 180);\r\n        });\r\n        this.btn_start.on(cc.Node.EventType.TOUCH_CANCEL, (e) => {\r\n            if (this.touchTarget && this.touchTarget != e.target) return;\r\n            this.touchTarget = null;\r\n            this.btn_start.color = new cc.Color(255, 255, 255);\r\n        });\r\n        this.btn_start.on(cc.Node.EventType.TOUCH_END, (e) => {\r\n            if (this.touchTarget && this.touchTarget != e.target) return;\r\n            this.touchTarget = null;\r\n            this.btn_start.color = new cc.Color(255, 255, 255);\r\n            AudioMgr.instance.play('button');\r\n            this.gameScript.startGame(Global.gameData.level);\r\n            this.node.active = false;\r\n            this.GameView.active = true;\r\n        });\r\n    }\r\n\r\n    onInitComplete() {\r\n        // preload level\r\n        this.gameScript = this.GameView.getComponent(GameView);\r\n        // this.gameScript.preload(Global.gameData.level);\r\n        if (Global.gameData.level <= Global.config.MaxLevel) {\r\n            this.gameScript.level_preload = Global.gameData.level;\r\n            this.gameScript.loadTimeStamp_preload = Date.now();\r\n            this.gameScript.loadStage(this.gameScript.level_preload, this.gameScript.loadTimeStamp_preload, true);\r\n        }\r\n        // init lvlSelect\r\n        this.lvlSelectScript.init();\r\n        // add listener\r\n        this.addBtnListener();\r\n    }\r\n\r\n    // update(dt) {}\r\n}\r\n"]}