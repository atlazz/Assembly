{"version":3,"sources":["Ad.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\component","sourcesContent":["import wx from \"../SDK/wx\";\r\nimport ws from \"../SDK/ws\";\r\nimport Global from \"../Global\";\r\n\r\nlet hasVideo = true;\r\n\r\nlet currentBannerPos: string = null;\r\nlet clickBannerCount: number = 0;\r\n\r\nlet banners = {};   // list of banner obj\r\nlet bannerUid = {};   // list of unit id\r\nlet bannerCnt_home = {};\r\nlet bannerCnt_treasure = {};\r\nlet currBannerIdx: number;\r\n\r\nexport const randomlyGetBanner = (pos: string) => {\r\n    if (!CC_WECHATGAME) return;\r\n    // 低版本SDK，无此方法返回\r\n    if (!wx.createBannerAd) return;\r\n    // initialize\r\n    if (Object.keys(bannerUid).length === 0) {\r\n        for (let i = 1; i <= Global.config.banner_number; i++) {\r\n            bannerUid[i] = Global.config.banner[i];\r\n            console.log(\"init uid: \", i, bannerUid[i])\r\n            banners[i] = wxCreatBanner(bannerUid[i]);\r\n            console.log(\"init bannerAD: \", i, banners[i])\r\n            bannerCnt_home[i] = 0;\r\n            bannerCnt_treasure[i] = 0;\r\n\r\n            // onError, 不写上不给show...\r\n            banners[i].onError((errMsg) => {\r\n                console.log(\"banner onError :\", errMsg)\r\n            })\r\n        }\r\n    }\r\n    // randomly select\r\n    currBannerIdx = Math.ceil(Math.random() * Global.config.banner_number);\r\n\r\n    /** 首页 */\r\n    if (pos == \"home\") {\r\n        // check counter\r\n        if (bannerCnt_home[currBannerIdx] >= Global.config.show_number) {\r\n            // recreate\r\n            banners[currBannerIdx] && banners[currBannerIdx].destroy();\r\n            banners[currBannerIdx] = wxCreatBanner(bannerUid[currBannerIdx]);\r\n            bannerCnt_home[currBannerIdx] = 0;\r\n        }\r\n        // update counter\r\n        bannerCnt_home[currBannerIdx]++;\r\n    }\r\n}\r\n\r\nexport const wxCreatBanner = (uid: string): any => {\r\n    if (!CC_WECHATGAME || !wx.createBannerAd) return;\r\n    let systemInfo = wx.getSystemInfoSync();\r\n    let screenHeight = systemInfo.screenHeight;\r\n    let screenWidth = systemInfo.screenWidth;\r\n    let adWidth = Math.max(300, screenWidth * 300 / 350);// * 0.86\r\n    let adHeight = adWidth * 0.348;\r\n    let top = screenHeight - adHeight;\r\n    let left = (screenWidth - adWidth) / 2;\r\n    return wx.createBannerAd({\r\n        adUnitId: uid,\r\n        style: {\r\n            left: left,\r\n            top: top,\r\n            width: adWidth,\r\n            height: adHeight,\r\n        }\r\n    });\r\n}\r\n\r\nexport const setStyle = (banner, isMini: boolean, bannerTop: number) => {\r\n    if (!CC_WECHATGAME) return;\r\n    if (!banner) return;\r\n    let systemInfo = wx.getSystemInfoSync();\r\n    let screenHeight = systemInfo.screenHeight;\r\n    let screenWidth = systemInfo.screenWidth;\r\n    let adWidth = screenWidth;\r\n    if (isMini) {\r\n        adWidth = Math.max(300, screenWidth * 300 / 350);// * 0.86\r\n    }\r\n    let adHeight = adWidth * 0.348;\r\n    // defalut at bottom\r\n    let top: number = screenHeight - adHeight;\r\n    // over write\r\n    if (bannerTop !== -1) {\r\n        top = bannerTop / cc.winSize.height * screenHeight;\r\n    }\r\n    let left = (screenWidth - adWidth) / 2;\r\n    banner.style.left = left;\r\n    banner.style.top = top;\r\n    banner.style.width = adWidth;\r\n    banner.style.height = adHeight;\r\n}\r\n\r\nexport const showBanner = (isMini: boolean = false, bannerTop: number = -1) => {\r\n    if (!CC_WECHATGAME) return;\r\n    setStyle(banners[currBannerIdx], isMini, bannerTop);\r\n    banners[currBannerIdx] && banners[currBannerIdx].show();\r\n    console.log(\"show banner uid: \", currBannerIdx, \"bannerAD: \", banners[currBannerIdx])\r\n}\r\n\r\nexport const hideBanner = () => {\r\n    if (!CC_WECHATGAME) return;\r\n    for (let i = 1; i <= Object.keys(banners).length; i++) {\r\n        banners[i] && banners[i].hide();\r\n    }\r\n    // banners[currBannerIdx] && banners[currBannerIdx].hide();\r\n}\r\n\r\n\r\nexport const refreshCurrentBanner = () => {\r\n    clickBannerCount++;\r\n    if (currentBannerPos && clickBannerCount >= Global.config.banner_click_time) {\r\n        clickBannerCount = 0;\r\n        posShowBanner(currentBannerPos, true);\r\n    }\r\n}\r\n\r\nexport const hasVideoAd = (): boolean => {\r\n    return hasVideo;\r\n}\r\n\r\nexport const posShowBanner = (pos: string, force: boolean = false): any => {\r\n    if (!CC_WECHATGAME) return;\r\n    let systemInfo = wx.getSystemInfoSync();\r\n    let screenHeight = systemInfo.screenHeight;\r\n    let screenWidth = systemInfo.screenWidth;\r\n    let adWidth = Math.max(300, screenWidth * 300 / 350);// * 0.86\r\n    let adHeight = adWidth * 0.348;\r\n    let top = screenHeight - adHeight;\r\n    let left = (screenWidth - adWidth) / 2;\r\n    currentBannerPos = pos;\r\n    return ws.createBanner({\r\n        pos,\r\n        style: {\r\n            left: left,\r\n            top: top,\r\n            width: adWidth,\r\n            height: adHeight,\r\n        },\r\n        force,\r\n    });\r\n};\r\n\r\nexport const posHideBanner = (pos: string) => {\r\n    if (!CC_WECHATGAME) return;\r\n    currentBannerPos = null;\r\n    ws.closeBanner(pos);\r\n};\r\n\r\nexport const posShowVideo = (pos: string, onErrorCallback: Function, onCloseCallback: Function) => {\r\n    if (CC_WECHATGAME && ws.createVideo) {\r\n        ws.createVideo({\r\n            pos: pos,\r\n            success: (res) => {\r\n                onCloseCallback && onCloseCallback(res);\r\n            },\r\n            fail: (res) => {\r\n                hasVideo = false;\r\n                console.log('NO VIDEO AD');\r\n                console.log(\"error res: \", res);\r\n                if (Global.gameData.videoCount <= 11) {\r\n                    ws.traceEvent(\"errVideoCnt_\" + Global.gameData.videoCount);\r\n                }\r\n                else {\r\n                    // 11次以上\r\n                    ws.traceEvent(\"errVideoCnt_11\");\r\n                }\r\n                if (res && res.errMsg) {\r\n                    ws.traceEvent(\"errCode_\" + res.errCode);\r\n                    console.log(\"errCode: \" + res.errCode);\r\n                    console.log(\"errMsg: \" + res.errMsg);\r\n                }\r\n                onErrorCallback && onErrorCallback();\r\n            }\r\n        });\r\n    } else {\r\n        hasVideo = false;\r\n        console.log('NO VIDEO AD');\r\n        onErrorCallback && onErrorCallback();\r\n    }\r\n}"]}